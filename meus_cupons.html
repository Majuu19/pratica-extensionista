<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meus Cupons - HenSoma</title>

  <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+Antique:wght@400;900&display=swap" rel="stylesheet">

<style>
:root {
  --primary-gradient: linear-gradient(180deg, #59599B 0%, #24243E 59%, #0F0C29 100%);
  --card-gradient: linear-gradient(180deg, #4D4D9E 40%, #34315E 88%);
  --shadow: 0px 4px 4px #AAA5E5;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Zen Kaku Gothic Antique', Arial, sans-serif;
  background: #F9F9FA;
  height: 100vh;
  display: flex;
  overflow: hidden;
}

.container {
  display: flex;
  width: 100%;
  height: 100%;
}

.sidebar {
  background: var(--primary-gradient);
  max-width: 470px;
  width: 100%;
  color: white;
  padding: 60px 32px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.logo {
  font-size: 3rem;
  font-weight: 900;
  margin-bottom: 32px;
}

.sidebar-img {
  width: 90%;
  max-width: 380px;
  border-radius: 16px;
  margin-bottom: 32px;
}

.sidebar-subtitle {
  font-size: 1.6rem;
  font-weight: 900;
  text-align: center;
}

.sidebar-desc {
  text-align: center;
  font-size: 1.1rem;
  color: #D2D2E0;
  margin-top: 12px;
}

.main {
  flex: 1;
  padding: 40px 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  overflow-y: auto;
}

.main-title {
  font-size: 2.4rem;
  font-weight: 900;
  color: #24243E;
  margin-bottom: 8px;
}

.main-subtitle {
  font-size: 1rem;
  color: #424242;
  text-transform: uppercase;
  margin-bottom: 30px;
}

.filter-tabs {
  display: flex;
  gap: 20px;
  margin-bottom: 30px;
}

.tab {
  padding: 10px 22px;
  background: #E4E4EE;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 700;
}

.tab.active {
  background: #24243E;
  color: white;
}

.coupons-area {
  width: 100%;
  max-width: 900px;
  display: flex;
  flex-wrap: wrap;
  gap: 24px;
  justify-content: center;
}

.coupon-card {
  background: var(--card-gradient);
  width: 260px;
  border-radius: 12px;
  padding: 20px;
  color: white;
  display: flex;
  flex-direction: column;
  gap: 10px;
  box-shadow: var(--shadow);
}

.coupon-title {
  font-size: 1.4rem;
  font-weight: 900;
}

.status {
  font-weight: 900;
  padding: 8px;
  border-radius: 6px;
  text-align: center;
}

.status.ATIVO {
  background: #D4F8D4;
  color: #207520;
}

.status.UTILIZADO {
  background: #FFE5A3;
  color: #9C6A00;
}

.status.VENCIDO {
  background: #F5C4C4;
  color: #9E0B0B;
}
</style>
</head>

<body>

<div class="container">

  <aside class="sidebar">
    <div class="logo">HenSoma</div>
    <img src="meuscupons.png" class="sidebar-img">
    <h2 class="sidebar-subtitle">Meus Cupons</h2>
    <p class="sidebar-desc">Acompanhe seus cupons reservados</p>
  </aside>

  <main class="main">

    <div class="main-title">Meus Cupons</div>
    <div class="main-subtitle">Filtre por status</div>

    <div class="filter-tabs">
      <div class="tab active" onclick="filtrar('todos', event)">Todos</div>
      <div class="tab" onclick="filtrar('ATIVO', event)">Ativos</div>
      <div class="tab" onclick="filtrar('UTILIZADO', event)">Utilizados</div>
      <div class="tab" onclick="filtrar('VENCIDO', event)">Vencidos</div>
    </div>

    <div class="coupons-area" id="listaCupons"></div>

  </main>
</div>

<script>
const token = localStorage.getItem("token");

if (!token) {
  alert("Sessão expirada. Faça login novamente.");
  window.location.href = "login.html";
}

const categoriaIdParaNome = {
  1: "Alimentação",
  2: "Vestuário",
  3: "Serviços",
  4: "Saúde"
};

let cupons = [];

async function carregarCupons() {
  try {
    const res = await fetch("http://localhost:3001/api/cupom/meus", {
      headers: { Authorization: `Bearer ${token}` }
    });

    const data = await res.json();
    if (!res.ok || data.status === "error") {
      throw new Error(data.message || "Erro");
    }

    cupons = data.data || [];
    renderizar(cupons);

  } catch (err) {
    console.error(err);
    alert("Erro ao carregar cupons");
  }
}

function renderizar(lista) {
  const area = document.getElementById("listaCupons");
  area.innerHTML = "";

  if (!lista.length) {
    area.innerHTML = "<p>Nenhum cupom encontrado.</p>";
    return;
  }

  lista.forEach(c => {
    area.innerHTML += `
      <div class="coupon-card">
        <div class="coupon-title">${c.titulo}</div>
        <div>Categoria: ${categoriaIdParaNome[c.categoria_id]}</div>
        <div>Validade: ${formatar(c.data_inicio)} a ${formatar(c.data_fim)}</div>
        <div>Disponíveis: ${c.quantidade_disponivel}</div>
        <div class="status ${c.status}">${c.status}</div>
      </div>
    `;
  });
}

function formatar(data) {
  return new Date(data).toLocaleDateString("pt-BR");
}

function filtrar(status, event) {
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  event.target.classList.add("active");

  if (status === "todos") {
    renderizar(cupons);
    return;
  }

  
  const filtered = cupons.filter(c => {
    const s = (c.status || '').toString().toLowerCase();
    return s === status.toLowerCase();
  });

  renderizar(filtered);
}

carregarCupons();
</script>

</body>
</html>
